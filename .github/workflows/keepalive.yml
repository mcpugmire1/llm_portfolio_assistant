name: Keep Streamlit Warm

on:
  schedule:
    - cron: "*/10 * * * *"
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install Puppeteer
        run: npm install puppeteer
      
      - name: Keep app warm
        env:
          APP_URL: ${{ secrets.STREAMLIT_APP_URL }}
        run: |
          node -e "
            const puppeteer = require('puppeteer');
            (async () => {
              const browser = await puppeteer.launch({
                headless: true,
                args: ['--no-sandbox', '--disable-setuid-sandbox']
              });
              const page = await browser.newPage();
              console.log('Loading ' + process.env.APP_URL);
              await page.goto(process.env.APP_URL, {waitUntil: 'networkidle0', timeout: 60000});
              await new Promise(r => setTimeout(r, 5000));
              console.log('Page loaded and waited 5s');
              await browser.close();
            })();
          "
